<!DOCTYPE html>
<html lang="en"><head><meta charset="UTF-8"/><meta name="viewport" content="width=device-width, initial-scale=1.0"/><title>Tutorials · Nmrc.jl</title><meta name="title" content="Tutorials · Nmrc.jl"/><meta property="og:title" content="Tutorials · Nmrc.jl"/><meta property="twitter:title" content="Tutorials · Nmrc.jl"/><meta name="description" content="Documentation for Nmrc.jl."/><meta property="og:description" content="Documentation for Nmrc.jl."/><meta property="twitter:description" content="Documentation for Nmrc.jl."/><meta property="og:url" content="https://peakfind.github.io/Nmrc.jl/flat/"/><meta property="twitter:url" content="https://peakfind.github.io/Nmrc.jl/flat/"/><link rel="canonical" href="https://peakfind.github.io/Nmrc.jl/flat/"/><script data-outdated-warner src="../assets/warner.js"></script><link href="https://cdnjs.cloudflare.com/ajax/libs/lato-font/3.0.0/css/lato-font.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/juliamono/0.050/juliamono.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.2/css/fontawesome.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.2/css/solid.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.2/css/brands.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/KaTeX/0.16.8/katex.min.css" rel="stylesheet" type="text/css"/><script>documenterBaseURL=".."</script><script src="https://cdnjs.cloudflare.com/ajax/libs/require.js/2.3.6/require.min.js" data-main="../assets/documenter.js"></script><script src="../search_index.js"></script><script src="../siteinfo.js"></script><script src="../../versions.js"></script><link class="docs-theme-link" rel="stylesheet" type="text/css" href="../assets/themes/catppuccin-mocha.css" data-theme-name="catppuccin-mocha"/><link class="docs-theme-link" rel="stylesheet" type="text/css" href="../assets/themes/catppuccin-macchiato.css" data-theme-name="catppuccin-macchiato"/><link class="docs-theme-link" rel="stylesheet" type="text/css" href="../assets/themes/catppuccin-frappe.css" data-theme-name="catppuccin-frappe"/><link class="docs-theme-link" rel="stylesheet" type="text/css" href="../assets/themes/catppuccin-latte.css" data-theme-name="catppuccin-latte"/><link class="docs-theme-link" rel="stylesheet" type="text/css" href="../assets/themes/documenter-dark.css" data-theme-name="documenter-dark" data-theme-primary-dark/><link class="docs-theme-link" rel="stylesheet" type="text/css" href="../assets/themes/documenter-light.css" data-theme-name="documenter-light" data-theme-primary/><script src="../assets/themeswap.js"></script></head><body><div id="documenter"><nav class="docs-sidebar"><div class="docs-package-name"><span class="docs-autofit"><a href="../">Nmrc.jl</a></span></div><button class="docs-search-query input is-rounded is-small is-clickable my-2 mx-auto py-1 px-2" id="documenter-search-query">Search docs (Ctrl + /)</button><ul class="docs-menu"><li><a class="tocitem" href="../">Home</a></li><li class="is-active"><a class="tocitem" href>Tutorials</a><ul class="internal"><li><a class="tocitem" href="#Introduction"><span>Introduction</span></a></li><li><a class="tocitem" href="#Numerical-examples"><span>Numerical examples</span></a></li></ul></li><li><a class="tocitem" href="../api/">API</a></li></ul><div class="docs-version-selector field has-addons"><div class="control"><span class="docs-label button is-static is-size-7">Version</span></div><div class="docs-selector control is-expanded"><div class="select is-fullwidth is-size-7"><select id="documenter-version-selector"></select></div></div></div></nav><div class="docs-main"><header class="docs-navbar"><a class="docs-sidebar-button docs-navbar-link fa-solid fa-bars is-hidden-desktop" id="documenter-sidebar-button" href="#"></a><nav class="breadcrumb"><ul class="is-hidden-mobile"><li class="is-active"><a href>Tutorials</a></li></ul><ul class="is-hidden-tablet"><li class="is-active"><a href>Tutorials</a></li></ul></nav><div class="docs-right"><a class="docs-navbar-link" href="https://github.com/peakfind/Nmrc.jl" title="View the repository on GitHub"><span class="docs-icon fa-brands"></span><span class="docs-label is-hidden-touch">GitHub</span></a><a class="docs-navbar-link" href="https://github.com/peakfind/Nmrc.jl/blob/main/docs/src/literate/flat.jl" title="Edit source on GitHub"><span class="docs-icon fa-solid"></span></a><a class="docs-settings-button docs-navbar-link fa-solid fa-gear" id="documenter-settings-button" href="#" title="Settings"></a><a class="docs-article-toggle-button fa-solid fa-chevron-up" id="documenter-article-toggle-button" href="javascript:;" title="Collapse all docstrings"></a></div></header><article class="content" id="documenter-page"><h1 id="Finite-element-method-with-transparent-boundary-condition"><a class="docs-heading-anchor" href="#Finite-element-method-with-transparent-boundary-condition">Finite element method with transparent boundary condition</a><a id="Finite-element-method-with-transparent-boundary-condition-1"></a><a class="docs-heading-anchor-permalink" href="#Finite-element-method-with-transparent-boundary-condition" title="Permalink"></a></h1><h2 id="Introduction"><a class="docs-heading-anchor" href="#Introduction">Introduction</a><a id="Introduction-1"></a><a class="docs-heading-anchor-permalink" href="#Introduction" title="Permalink"></a></h2><p>Consider a flat surface illuminated by a plane wave. The incident field is given by</p><p class="math-container">\[u^{\text{in}} = e^{i\alpha x_{1} - i\beta x_{2}},\]</p><p>where <span>$\alpha = k\sin\theta, \beta = k\cos\theta$</span>; <span>$k &gt; 0$</span> is the wave number, and <span>$\theta \in (-\pi/2, \pi/2)$</span> is the incident angle. We assume that the total field <span>$u = u^{\test{in}} + u^{\text{sc}}$</span>, composed of the incident field <span>$u^{\test{in}}$</span> and the scattered field <span>$u^{\text{sc}}$</span>, satisfies the Dirichelt boundary condition on the bottom <span>$x_{2} = 0$</span>.</p><p>Due to the periodic structure and incident plane wave, we can work on periodic function space, that is, <span>$v = ue^{-i\alpha x_{1}}$</span>. So the exact solution is <span>$v_{\text{exact}} = -2i\sin(\beta x_{2})$</span>.</p><h2 id="Numerical-examples"><a class="docs-heading-anchor" href="#Numerical-examples">Numerical examples</a><a id="Numerical-examples-1"></a><a class="docs-heading-anchor-permalink" href="#Numerical-examples" title="Permalink"></a></h2><p>First, we load Nmrc and Ferrite (Ferrite is used to define the interpolation).</p><pre><code class="language-julia hljs">using Nmrc, Ferrite</code></pre><h3 id="Parameters"><a class="docs-heading-anchor" href="#Parameters">Parameters</a><a id="Parameters-1"></a><a class="docs-heading-anchor-permalink" href="#Parameters" title="Permalink"></a></h3><p>We assume that the wavenumber is <span>$1.0$</span> and the incident angle is <span>$\pi/3$</span>.</p><pre><code class="language-julia hljs"># incident plane wave
k = 1.0
θ = π/3
inc = Incident(k, θ)

# Number of the truncated terms
N = 10;

# Height of the artificial boundary
height = 2.0;</code></pre><h3 id="Generating-a-mesh-by-Gmsh"><a class="docs-heading-anchor" href="#Generating-a-mesh-by-Gmsh">Generating a mesh by Gmsh</a><a id="Generating-a-mesh-by-Gmsh-1"></a><a class="docs-heading-anchor-permalink" href="#Generating-a-mesh-by-Gmsh" title="Permalink"></a></h3><p>We generate a mesh on a periodic cell which is a rectangle <span>$(0.0, 2\pi) \times (0.0, 2.0)$</span>.</p><pre><code class="language-julia hljs"># Generate the mesh in a periodic cell
grid = periodic_cell(0.1; height=height)</code></pre><pre class="documenter-example-output"><code class="nohighlight hljs ansi">Ferrite.Grid{2, Ferrite.Triangle, Float64} with 2980 Ferrite.Triangle cells and 1574 nodes</code></pre><h3 id="Setting-up-finite-element-space-and-boundary-conditions"><a class="docs-heading-anchor" href="#Setting-up-finite-element-space-and-boundary-conditions">Setting up finite element space and boundary conditions</a><a id="Setting-up-finite-element-space-and-boundary-conditions-1"></a><a class="docs-heading-anchor-permalink" href="#Setting-up-finite-element-space-and-boundary-conditions" title="Permalink"></a></h3><p>We choose <span>$P1$</span> element here. Then <code>CellValues</code> and <code>FacetValues</code> can be constructed by the function <a href="../api/#Nmrc.setup_vals-Tuple{Any}"><code>setup_vals</code></a>.</p><pre><code class="language-julia hljs">ip = Lagrange{RefTriangle, 1}()
cv, fv = setup_vals(ip)</code></pre><pre class="documenter-example-output"><code class="nohighlight hljs ansi">(Ferrite.CellValues{Ferrite.FunctionValues{1, Ferrite.Lagrange{Ferrite.RefTriangle, 1, Nothing}, Matrix{Float64}, Matrix{Tensors.Vec{2, Float64}}, Matrix{Tensors.Vec{2, Float64}}, Nothing, Nothing}, Ferrite.GeometryMapping{1, Ferrite.Lagrange{Ferrite.RefTriangle, 1, Nothing}, Matrix{Float64}, Matrix{Tensors.Vec{2, Float64}}, Nothing}, Ferrite.QuadratureRule{Ferrite.RefTriangle, Vector{Float64}, Vector{Tensors.Vec{2, Float64}}}, Vector{Float64}}(Ferrite.FunctionValues{1, Ferrite.Lagrange{Ferrite.RefTriangle, 1, Nothing}, Matrix{Float64}, Matrix{Tensors.Vec{2, Float64}}, Matrix{Tensors.Vec{2, Float64}}, Nothing, Nothing}(Lagrange{Ferrite.RefTriangle, 1}(), [0.16666666666667 0.16666666666667 0.66666666666667; 0.16666666666667 0.66666666666667 0.16666666666667; 0.6666666666666601 0.16666666666666008 0.16666666666666005], [0.16666666666667 0.16666666666667 0.66666666666667; 0.16666666666667 0.66666666666667 0.16666666666667; 0.6666666666666601 0.16666666666666008 0.16666666666666005], Tensors.Vec{2, Float64}[[NaN, NaN] [NaN, NaN] [NaN, NaN]; [NaN, NaN] [NaN, NaN] [NaN, NaN]; [NaN, NaN] [NaN, NaN] [NaN, NaN]], Tensors.Vec{2, Float64}[[1.0, 0.0] [1.0, 0.0] [1.0, 0.0]; [0.0, 1.0] [0.0, 1.0] [0.0, 1.0]; [-1.0, -1.0] [-1.0, -1.0] [-1.0, -1.0]], nothing, nothing), Ferrite.GeometryMapping{1, Ferrite.Lagrange{Ferrite.RefTriangle, 1, Nothing}, Matrix{Float64}, Matrix{Tensors.Vec{2, Float64}}, Nothing}(Lagrange{Ferrite.RefTriangle, 1}(), [0.16666666666667 0.16666666666667 0.66666666666667; 0.16666666666667 0.66666666666667 0.16666666666667; 0.6666666666666601 0.16666666666666008 0.16666666666666005], Tensors.Vec{2, Float64}[[1.0, 0.0] [1.0, 0.0] [1.0, 0.0]; [0.0, 1.0] [0.0, 1.0] [0.0, 1.0]; [-1.0, -1.0] [-1.0, -1.0] [-1.0, -1.0]], nothing), Ferrite.QuadratureRule{Ferrite.RefTriangle, Vector{Float64}, Vector{Tensors.Vec{2, Float64}}}([0.166666666666665, 0.166666666666665, 0.166666666666665], Tensors.Vec{2, Float64}[[0.16666666666667, 0.16666666666667], [0.16666666666667, 0.66666666666667], [0.66666666666667, 0.16666666666667]]), [NaN, NaN, NaN]), Ferrite.FacetValues{Ferrite.FunctionValues{1, Ferrite.Lagrange{Ferrite.RefTriangle, 1, Nothing}, Matrix{Float64}, Matrix{Tensors.Vec{2, Float64}}, Matrix{Tensors.Vec{2, Float64}}, Nothing, Nothing}, Ferrite.GeometryMapping{1, Ferrite.Lagrange{Ferrite.RefTriangle, 1, Nothing}, Matrix{Float64}, Matrix{Tensors.Vec{2, Float64}}, Nothing}, Ferrite.FacetQuadratureRule{Ferrite.RefTriangle, Vector{Ferrite.QuadratureRule{Ferrite.RefTriangle, Vector{Float64}, Vector{Tensors.Vec{2, Float64}}}}}, Vector{Float64}, Vector{Tensors.Vec{2, Float64}}, Vector{Ferrite.FunctionValues{1, Ferrite.Lagrange{Ferrite.RefTriangle, 1, Nothing}, Matrix{Float64}, Matrix{Tensors.Vec{2, Float64}}, Matrix{Tensors.Vec{2, Float64}}, Nothing, Nothing}}, Vector{Ferrite.GeometryMapping{1, Ferrite.Lagrange{Ferrite.RefTriangle, 1, Nothing}, Matrix{Float64}, Matrix{Tensors.Vec{2, Float64}}, Nothing}}}(Ferrite.FunctionValues{1, Ferrite.Lagrange{Ferrite.RefTriangle, 1, Nothing}, Matrix{Float64}, Matrix{Tensors.Vec{2, Float64}}, Matrix{Tensors.Vec{2, Float64}}, Nothing, Nothing}[Ferrite.FunctionValues{1, Ferrite.Lagrange{Ferrite.RefTriangle, 1, Nothing}, Matrix{Float64}, Matrix{Tensors.Vec{2, Float64}}, Matrix{Tensors.Vec{2, Float64}}, Nothing, Nothing}(Lagrange{Ferrite.RefTriangle, 1}(), [0.7886751345948129 0.21132486540518713; 0.21132486540518713 0.7886751345948129; 0.0 0.0], [0.7886751345948129 0.21132486540518713; 0.21132486540518713 0.7886751345948129; 0.0 0.0], Tensors.Vec{2, Float64}[[NaN, NaN] [NaN, NaN]; [NaN, NaN] [NaN, NaN]; [NaN, NaN] [NaN, NaN]], Tensors.Vec{2, Float64}[[1.0, 0.0] [1.0, 0.0]; [0.0, 1.0] [0.0, 1.0]; [-1.0, -1.0] [-1.0, -1.0]], nothing, nothing), Ferrite.FunctionValues{1, Ferrite.Lagrange{Ferrite.RefTriangle, 1, Nothing}, Matrix{Float64}, Matrix{Tensors.Vec{2, Float64}}, Matrix{Tensors.Vec{2, Float64}}, Nothing, Nothing}(Lagrange{Ferrite.RefTriangle, 1}(), [0.0 0.0; 0.7886751345948129 0.21132486540518713; 0.21132486540518713 0.7886751345948129], [0.0 0.0; 0.7886751345948129 0.21132486540518713; 0.21132486540518713 0.7886751345948129], Tensors.Vec{2, Float64}[[NaN, NaN] [NaN, NaN]; [NaN, NaN] [NaN, NaN]; [NaN, NaN] [NaN, NaN]], Tensors.Vec{2, Float64}[[1.0, 0.0] [1.0, 0.0]; [0.0, 1.0] [0.0, 1.0]; [-1.0, -1.0] [-1.0, -1.0]], nothing, nothing), Ferrite.FunctionValues{1, Ferrite.Lagrange{Ferrite.RefTriangle, 1, Nothing}, Matrix{Float64}, Matrix{Tensors.Vec{2, Float64}}, Matrix{Tensors.Vec{2, Float64}}, Nothing, Nothing}(Lagrange{Ferrite.RefTriangle, 1}(), [0.21132486540518713 0.7886751345948129; 0.0 0.0; 0.7886751345948129 0.21132486540518713], [0.21132486540518713 0.7886751345948129; 0.0 0.0; 0.7886751345948129 0.21132486540518713], Tensors.Vec{2, Float64}[[NaN, NaN] [NaN, NaN]; [NaN, NaN] [NaN, NaN]; [NaN, NaN] [NaN, NaN]], Tensors.Vec{2, Float64}[[1.0, 0.0] [1.0, 0.0]; [0.0, 1.0] [0.0, 1.0]; [-1.0, -1.0] [-1.0, -1.0]], nothing, nothing)], Ferrite.GeometryMapping{1, Ferrite.Lagrange{Ferrite.RefTriangle, 1, Nothing}, Matrix{Float64}, Matrix{Tensors.Vec{2, Float64}}, Nothing}[Ferrite.GeometryMapping{1, Ferrite.Lagrange{Ferrite.RefTriangle, 1, Nothing}, Matrix{Float64}, Matrix{Tensors.Vec{2, Float64}}, Nothing}(Lagrange{Ferrite.RefTriangle, 1}(), [0.7886751345948129 0.21132486540518713; 0.21132486540518713 0.7886751345948129; 0.0 0.0], Tensors.Vec{2, Float64}[[1.0, 0.0] [1.0, 0.0]; [0.0, 1.0] [0.0, 1.0]; [-1.0, -1.0] [-1.0, -1.0]], nothing), Ferrite.GeometryMapping{1, Ferrite.Lagrange{Ferrite.RefTriangle, 1, Nothing}, Matrix{Float64}, Matrix{Tensors.Vec{2, Float64}}, Nothing}(Lagrange{Ferrite.RefTriangle, 1}(), [0.0 0.0; 0.7886751345948129 0.21132486540518713; 0.21132486540518713 0.7886751345948129], Tensors.Vec{2, Float64}[[1.0, 0.0] [1.0, 0.0]; [0.0, 1.0] [0.0, 1.0]; [-1.0, -1.0] [-1.0, -1.0]], nothing), Ferrite.GeometryMapping{1, Ferrite.Lagrange{Ferrite.RefTriangle, 1, Nothing}, Matrix{Float64}, Matrix{Tensors.Vec{2, Float64}}, Nothing}(Lagrange{Ferrite.RefTriangle, 1}(), [0.21132486540518713 0.7886751345948129; 0.0 0.0; 0.7886751345948129 0.21132486540518713], Tensors.Vec{2, Float64}[[1.0, 0.0] [1.0, 0.0]; [0.0, 1.0] [0.0, 1.0]; [-1.0, -1.0] [-1.0, -1.0]], nothing)], Ferrite.FacetQuadratureRule{Ferrite.RefTriangle, Vector{Ferrite.QuadratureRule{Ferrite.RefTriangle, Vector{Float64}, Vector{Tensors.Vec{2, Float64}}}}}(Ferrite.QuadratureRule{Ferrite.RefTriangle, Vector{Float64}, Vector{Tensors.Vec{2, Float64}}}[Ferrite.QuadratureRule{Ferrite.RefTriangle, Vector{Float64}, Vector{Tensors.Vec{2, Float64}}}([0.4999999999999999, 0.4999999999999999], Tensors.Vec{2, Float64}[[0.7886751345948129, 0.21132486540518713], [0.21132486540518713, 0.7886751345948129]]), Ferrite.QuadratureRule{Ferrite.RefTriangle, Vector{Float64}, Vector{Tensors.Vec{2, Float64}}}([0.4999999999999999, 0.4999999999999999], Tensors.Vec{2, Float64}[[0.0, 0.7886751345948129], [0.0, 0.21132486540518713]]), Ferrite.QuadratureRule{Ferrite.RefTriangle, Vector{Float64}, Vector{Tensors.Vec{2, Float64}}}([0.4999999999999999, 0.4999999999999999], Tensors.Vec{2, Float64}[[0.21132486540518713, 0.0], [0.7886751345948129, 0.0]])]), [NaN, NaN], Tensors.Vec{2, Float64}[[NaN, NaN], [NaN, NaN]], 1))</code></pre><p><code>DofHandler</code> handles numbering and distribution of degrees of freedom (dofs) of our solution.</p><pre><code class="language-julia hljs">dh = setup_dh(grid, ip)</code></pre><pre class="documenter-example-output"><code class="nohighlight hljs ansi">Ferrite.DofHandler{2, Ferrite.Grid{2, Ferrite.Triangle, Float64}}
  Fields:
    :u, Lagrange{Ferrite.RefTriangle, 1}()
  Dofs per cell: 3
  Total dofs: 1574</code></pre><p>We use <a href="../api/#Nmrc.setup_bcs-Tuple{Ferrite.DofHandler}"><code>setup_bcs</code></a> to construct our <code>ConstraintHandler</code> which contains the information of the boundary conditions. In this tutorial, we impose the Dirichelt boundary condition on the lower boundary and the periodic boundary condition on the left and right boundaries.</p><pre><code class="language-julia hljs">cst = setup_bcs(dh)</code></pre><pre class="documenter-example-output"><code class="nohighlight hljs ansi">ConstraintHandler:
  BCs:
    Field: u, Components: [1]</code></pre><h3 id="Assembling-the-stiffness-matrix"><a class="docs-heading-anchor" href="#Assembling-the-stiffness-matrix">Assembling the stiffness matrix</a><a id="Assembling-the-stiffness-matrix-1"></a><a class="docs-heading-anchor-permalink" href="#Assembling-the-stiffness-matrix" title="Permalink"></a></h3><p>We allocate the stiffness matrix <span>$A$</span>, the TBC matrix <span>$F$</span> and the load vector <span>$f$</span>. Due to the DtN map, we need to extract the dofs associated to the artificial boundary.</p><pre><code class="language-julia hljs"># Extract dofs on the &quot;top&quot; boundary
top = getfacetset(grid, &quot;top&quot;)
dofsDtN = dofs_on_dtn(dh, :u, top)</code></pre><pre class="documenter-example-output"><code class="nohighlight hljs ansi">64-element Vector{Int64}:
   10
  109
  111
  122
  143
  144
  166
  191
  217
  233
    ⋮
 1494
 1497
 1501
 1508
 1538
 1542
 1543
 1565
 1566</code></pre><p>Then we create the sparse pattern of <span>$A$</span> and <span>$F$</span>. For more details, please refer to <a href="../api/#Nmrc.allocate_stiff_matrix-Tuple{Ferrite.DofHandler, Ferrite.ConstraintHandler, Any}"><code>allocate_stiff_matrix</code></a>.</p><pre><code class="language-julia hljs"># Allocate the stiffness matrix and the load vector
A = allocate_stiff_matrix(dh, cst, dofsDtN)
F = allocate_stiff_matrix(dh, cst, dofsDtN)
f = zeros(ComplexF64, ndofs(dh));

# Assemble the load vector f
f = assemble_load(fv, dh, top, f, inc, height)

# Assemble the matrix A
A = assemble_A(cv, dh, A, inc)

# Assemble the TBC matrix
F = assemble_tbc(fv, dh, inc, top, F, N, dofsDtN)</code></pre><pre class="documenter-example-output"><code class="nohighlight hljs ansi">1574×1574 SparseArrays.SparseMatrixCSC{ComplexF64, Int64} with 14666 stored entries:
⎡⠿⣧⣿⣿⣣⣩⣟⣜⠈⠀⠄⠔⠠⠐⠴⠴⠈⣰⠤⠀⣅⡂⠀⠀⢠⢘⢐⢣⢂⡒⡆⣟⣿⠁⢊⢩⢭⠸⢹⡊⎤
⎢⣿⣿⣿⣿⣿⣿⣧⢷⠶⠁⠄⠁⠈⡠⢓⠁⠨⢃⠁⠠⣤⡓⠁⠈⢠⡀⢰⡆⠡⢋⡀⣿⣿⡇⣸⢼⣶⣺⣾⣾⎥
⎢⡍⣺⣿⣿⣿⣿⡿⣿⢟⡁⠂⡡⠀⡤⡄⡉⡶⢈⢅⠈⣄⡢⢸⠀⠉⠩⡸⠐⠑⢀⠐⣭⣯⡅⢬⢨⣽⢨⣿⣯⎥
⎢⣛⢽⢭⣟⣿⣯⢻⣶⣆⠇⡀⠀⠈⠬⡍⡻⢦⢧⠏⠘⢲⠄⠐⠈⢐⢀⡀⢈⠀⣖⡓⣭⢻⠁⠈⠬⢯⠬⢽⣫⎥
⎢⠂⠀⠜⠃⠟⠱⠬⠝⠿⣧⣤⣝⡯⢘⣐⣎⢵⢿⣱⠽⡯⠷⠤⠬⢐⠄⠀⡃⠃⢁⣍⠤⢑⠀⠐⠀⠘⠯⠩⠢⎥
⎢⢀⠅⠄⠁⠌⡠⠀⠈⣄⢿⠿⣧⣿⣸⣦⠶⠚⣢⣦⣞⡌⠁⠈⢠⡧⠇⢠⠽⡆⢈⣨⠀⠈⠋⡄⠶⠤⠂⠸⢠⎥
⎢⢀⠂⠂⡠⠀⡤⡂⡄⣋⢋⣛⣻⣿⣿⣿⣽⡞⣫⣯⣾⡴⢒⡐⣀⠢⠽⠀⠀⠁⡑⢋⠆⠀⠞⠹⣔⢑⡰⠁⢀⎥
⎢⢐⡇⠝⠐⡄⠩⣧⡩⡰⢼⢨⡟⣟⣿⢿⣷⣿⣷⡿⣇⠖⠰⠂⠀⡨⢵⠀⣢⠨⣟⣥⠗⢸⠁⠰⣍⢣⠀⠀⠹⎥
⎢⢂⣠⠦⢂⡘⢋⠬⣗⣵⣗⠺⣠⡾⣩⢿⣿⣿⣿⣿⣿⣦⡮⢄⠌⣰⣨⠨⡊⢀⡟⠘⠀⠐⢬⡫⡋⣀⣃⠒⠀⎥
⎢⠀⠃⠁⡀⡁⠑⣋⠁⣕⡞⣨⢿⣫⣿⠿⢯⣿⣿⣿⣿⣧⡾⣷⡛⠲⣀⠂⠲⠨⡌⠌⠄⠀⢰⡭⣿⠐⡤⣿⠈⎥
⎢⠡⠹⢤⠻⠠⡹⠘⠖⢯⡏⠆⠉⢰⢋⢘⡁⡨⡿⣩⡿⢿⣷⣿⣧⣾⣸⣎⢪⠐⣼⣯⠀⠰⡌⣽⡍⢉⡟⠉⠊⎥
⎢⠀⠀⡁⠀⠒⠒⡐⠀⡀⡇⠂⣀⠐⢨⠈⠀⡀⠕⣽⠻⠿⣿⣿⣿⣿⣻⣟⢹⡀⠣⣯⠀⠨⣟⣉⠁⠉⡁⠗⠂⎥
⎢⣀⢒⠀⠲⡇⡀⠐⢐⠐⠔⠭⠏⣌⡆⢆⣎⡐⣺⠘⢢⣚⣻⣿⣻⣿⣿⣧⣿⣶⣽⡟⠀⠠⠿⢟⢉⣖⣁⡁⠆⎥
⎢⠴⣐⠰⠶⢒⠊⡀⢈⠤⠠⣄⡖⠀⠀⠠⣠⡢⠢⢨⡀⡪⣙⣟⣙⣭⣿⣿⣿⣿⣿⣿⠀⠈⡋⡎⡔⢱⢎⠷⠁⎥
⎢⢨⠰⡥⢂⠑⢀⢠⢤⠍⢀⡈⢉⢅⠠⣦⢦⣤⠴⡂⠦⣐⣤⠤⡈⣜⣿⣿⣿⣿⣿⣿⡄⢰⣲⡿⡆⡀⠠⠆⠄⎥
⎢⣬⢭⣤⣬⡔⣤⡝⣬⠃⡝⠂⠚⠫⠔⢥⠟⠒⠀⠂⠅⠋⠛⠋⠛⠛⠉⠛⠛⠛⠿⠟⣥⣤⡿⢳⢰⣤⢠⣤⣤⎥
⎢⠟⠛⠿⠿⠏⠿⠟⠒⠑⠐⡦⠀⣠⠄⠖⠒⡐⣄⢀⣀⡐⠦⣦⢦⣤⡆⡦⠠⢰⣲⣤⡿⠿⣧⣼⣾⣿⢼⡿⠻⎥
⎢⡎⣐⣒⣞⡂⣓⡂⡄⠐⠀⢠⡍⢓⢦⡔⢦⡯⠪⣧⣯⡗⠿⠇⠘⡟⢑⢊⠭⠻⠯⢙⣒⣲⣿⣿⣿⣿⣿⣷⣐⎥
⎢⣃⡓⣸⣻⡓⣛⡋⡗⡶⡄⠠⠃⢑⡰⠉⠒⠤⢸⠐⡤⣧⠴⠇⠠⠜⢹⡱⢖⠀⡈⠀⣛⣛⣟⣿⣿⣿⣿⣿⣘⎥
⎣⡳⠲⣺⣿⡿⣿⡷⣳⠣⡂⠒⣂⠁⢀⣄⡀⠘⠀⡛⠛⡣⠀⠹⠁⠡⠌⠝⠃⠈⠅⠀⣿⣿⡋⢙⢻⣛⢻⣿⣿⎦</code></pre><p>Be careful! Calculations between two sparse matrices may destory the structure of sparse matrices. Then imposing the boundary condition may fail. So we use <a href="../api/#Nmrc.sub_preserve_structure-Tuple{SparseArrays.SparseMatrixCSC, SparseArrays.SparseMatrixCSC}"><code>sub_preserve_structure</code></a> to subtract <span>$F$</span> from <span>$A$</span> with keeping the structure of <span>$A$</span>.</p><pre><code class="language-julia hljs"># Add the TBC matrix to A = A - F
A = sub_preserve_structure(A, F)

# Impose the boundary condition
apply!(A, f, cst)

# Solve the linear system
u = A\f

# Apply the boundary condition again
apply!(u, cst)</code></pre><pre class="documenter-example-output"><code class="nohighlight hljs ansi">1574-element Vector{ComplexF64}:
   3.158683268810116e-5 - 0.15317244858344584im
  1.7158948105089617e-5 - 0.09651732153593437im
    3.79994723326924e-5 - 0.20674399138797583im
 -2.5584384023723487e-5 - 0.09624018671542418im
  -5.393305399234056e-5 - 0.20446036151544966im
 -4.0360981259559305e-5 - 0.15296601009255503im
 0.00010349732894413891 - 0.18883980316651755im
   4.906580304024992e-5 - 0.08636434114583684im
  4.5931041288458144e-5 - 0.08636330998468002im
   5.562684550090564e-5 - 1.6827193257988013im
                        ⋮
  -0.010124949146285431 - 1.682889105761293im
   0.001299890206179951 - 1.6419189991224463im
                    0.0 + 0.0im
                    0.0 + 0.0im
   5.812820521565083e-5 - 0.23554401819482904im
  -3.317216149964981e-5 - 0.14140319196319232im
 0.00016500884652190343 - 0.22843204821949303im
  0.0003688976164628844 - 0.49466242858564047im
  0.0002486683289360293 - 0.32632210400148437im</code></pre><h3 id="Export-the-VTK"><a class="docs-heading-anchor" href="#Export-the-VTK">Export the VTK</a><a id="Export-the-VTK-1"></a><a class="docs-heading-anchor-permalink" href="#Export-the-VTK" title="Permalink"></a></h3><p>Finally, we write the real part and imaginary part of the solution into vtk files which can be visualized by Paraview.</p><pre><code class="language-julia hljs">VTKGridFile(&quot;real_u&quot;, grid) do vtk
   write_solution(vtk, dh, real.(u))
end;

VTKGridFile(&quot;imag_u&quot;, grid) do vtk
    write_solution(vtk, dh, imag.(u))
end;</code></pre><hr/><p><em>This page was generated using <a href="https://github.com/fredrikekre/Literate.jl">Literate.jl</a>.</em></p></article><nav class="docs-footer"><a class="docs-footer-prevpage" href="../">« Home</a><a class="docs-footer-nextpage" href="../api/">API »</a><div class="flexbox-break"></div><p class="footer-message">Powered by <a href="https://github.com/JuliaDocs/Documenter.jl">Documenter.jl</a> and the <a href="https://julialang.org/">Julia Programming Language</a>.</p></nav></div><div class="modal" id="documenter-settings"><div class="modal-background"></div><div class="modal-card"><header class="modal-card-head"><p class="modal-card-title">Settings</p><button class="delete"></button></header><section class="modal-card-body"><p><label class="label">Theme</label><div class="select"><select id="documenter-themepicker"><option value="auto">Automatic (OS)</option><option value="documenter-light">documenter-light</option><option value="documenter-dark">documenter-dark</option><option value="catppuccin-latte">catppuccin-latte</option><option value="catppuccin-frappe">catppuccin-frappe</option><option value="catppuccin-macchiato">catppuccin-macchiato</option><option value="catppuccin-mocha">catppuccin-mocha</option></select></div></p><hr/><p>This document was generated with <a href="https://github.com/JuliaDocs/Documenter.jl">Documenter.jl</a> version 1.10.1 on <span class="colophon-date" title="Monday 7 April 2025 14:05">Monday 7 April 2025</span>. Using Julia version 1.11.4.</p></section><footer class="modal-card-foot"></footer></div></div></div></body></html>
